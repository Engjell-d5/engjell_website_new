# Fix for /etc/apache2/sites-enabled/engjellrraklli.com-le-ssl.conf

Edit the file:
sudo nano /etc/apache2/sites-enabled/engjellrraklli.com-le-ssl.conf

Replace the entire content with this:

<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerAdmin webmaster@localhost
    ServerName engjellrraklli.com
    ServerAlias www.engjellrraklli.com

    # SSL Configuration (must be before other directives)
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/engjellrraklli.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/engjellrraklli.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/engjellrraklli.com-error.log
    CustomLog ${APACHE_LOG_DIR}/engjellrraklli.com-access.log combined

    # Proxy settings
    ProxyPreserveHost On
    
    # WebSocket support
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*) ws://127.0.0.1:7776/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    RewriteRule /(.*) http://127.0.0.1:7776/$1 [P,L]

    # Alternative: Simple proxy (if WebSocket rewrite causes issues, use this instead)
    # ProxyPass / http://127.0.0.1:7776/
    # ProxyPassReverse / http://127.0.0.1:7776/

    # Additional proxy headers
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Port "443"
</VirtualHost>
</IfModule>

Key changes:
1. Changed port from 3000 to 7776
2. Fixed WebSocket rewrite to handle both websocket and non-websocket requests
3. Moved SSL configuration to the top (best practice)
4. Added X-Forwarded-Proto header
5. Updated log file names to match

After editing, test and reload:
sudo apache2ctl configtest
sudo systemctl reload apache2
